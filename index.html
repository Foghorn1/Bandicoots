<!doctype html>
<html lang="pt-PT">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lupa ‚Äî Zoom de Imagem Simples</title>
  <style>
    :root{--lens-size:140px;--zoom:2.5}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,\"Helvetica Neue\",Arial;display:flex;align-items:center;justify-content:center;min-height:100vh;margin:0;background:#f5f6f8;color:#111}
    .card{background:#fff;border-radius:12px;padding:18px;box-shadow:0 6px 18px rgba(16,24,40,0.06);max-width:900px;width:95%}
    h1{margin:0 0 12px;font-size:18px}
    .controls{display:flex;gap:8px;align-items:center;margin-bottom:12px}
    .btn{background:#0b5fff;color:#fff;border:0;padding:8px 12px;border-radius:8px;cursor:pointer;display:inline-flex;gap:8px;align-items:center}
    .btn.secondary{background:#e6eefc;color:#03396b}
    .img-wrap{position:relative;max-width:700px}
    img.zoomable{max-width:100%;display:block;border-radius:8px}

    /* Lente circular */
    .lens{
      position:absolute;
      border-radius:50%;
      width:var(--lens-size);
      height:var(--lens-size);
      box-shadow:0 6px 18px rgba(2,6,23,0.15), inset 0 0 12px rgba(255,255,255,0.3);
      pointer-events:none; /* n√£o bloqueia o cursor */
      display:none; /* mostra s√≥ quando ativo */
      transform:translate(-50%,-50%);
      background-repeat:no-repeat;
      border:2px solid rgba(255,255,255,0.6);
    }

    /* Mensagem de ajuda (pequena) */
    .hint{font-size:13px;color:#556;}

    /* Alternativa: zoom em janela lateral (opcional) */
    .result{
      position:absolute;right:-320px;top:0;width:300px;height:300px;border-radius:8px;overflow:hidden;border:1px solid #e6e9ef;background:#fff;display:none;box-shadow:0 6px 18px rgba(2,6,23,0.06)
    }
    .result img{width:100%;height:100%;object-fit:cover}

    /* Responsivo */
    @media (max-width:900px){
      .result{display:none !important;right:0;position:relative;margin-top:12px}
      .img-row{display:block}
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>Lupa ‚Äî Zoom de Imagem (simples)</h1>
    <div class="controls">
      <button id="toggleLens" class="btn" aria-pressed="false" title="Ativar / Desativar lupa">üîç Ativar lupa</button>
      <button id="toggleSide" class="btn secondary" title="Mostrar / ocultar janela lateral de zoom">‚ñ¢ Janela de zoom</button>
      <div class="hint">Move o cursor sobre a imagem (ou toca) depois de ativar a lupa.</div>
    </div>

    <div class="img-row" style="display:flex;gap:18px;align-items:flex-start;position:relative">
      <div class="img-wrap">
        <!-- Substitui o src pela tua imagem -->
        <img id="image" class="zoomable" src="Bandicoots.png" alt="Bandicoots">
        <div id="lens" class="lens" role="img" aria-hidden="true"></div>
      </div>

      <div id="result" class="result" aria-hidden="true">
        <img id="resultImg" alt="Zoom da imagem">
      </div>
    </div>
  </div>

  <script>
    // Elementos
    const img = document.getElementById('image');
    const lens = document.getElementById('lens');
    const toggleBtn = document.getElementById('toggleLens');
    const toggleSide = document.getElementById('toggleSide');
    const result = document.getElementById('result');
    const resultImg = document.getElementById('resultImg');

    // Estado
    let active = false;
    let showSide = false;

    // Configura√ß√µes (podes alterar)
    const zoom = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--zoom')) || 2.5;
    const lensSize = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--lens-size')) || 140;

    // Prepara imagens
    function prepare(){
      // Para a lente circular, usamos imagem de background com tamanho aumentado
      const naturalW = img.naturalWidth;
      const naturalH = img.naturalHeight;
      lens.style.backgroundImage = `url('${img.src}')`;
      // Calcula escala entre natural size e display size
      const rect = img.getBoundingClientRect();
      const scaleX = naturalW / rect.width;
      const scaleY = naturalH / rect.height;
      lens.dataset.scaleX = scaleX;
      lens.dataset.scaleY = scaleY;
      resultImg.src = img.src;
      result.style.display = showSide ? 'block' : 'none';
    }

    // Ativa/desativa o modo lupa
    toggleBtn.addEventListener('click', ()=>{
      active = !active;
      toggleBtn.textContent = active ? 'üîç Lupa ativa' : 'üîç Ativar lupa';
      toggleBtn.setAttribute('aria-pressed', String(active));
      lens.style.display = active ? 'block' : 'none';
      result.style.display = active && showSide ? 'block' : 'none';
    });

    // Alterna a janela lateral (janela de zoom)
    toggleSide.addEventListener('click', ()=>{
      showSide = !showSide;
      toggleSide.textContent = showSide ? '‚ñ¢ Janela vis√≠vel' : '‚ñ¢ Janela de zoom';
      result.style.display = showSide && active ? 'block' : 'none';
    });

    // Calcula posi√ß√£o da lente e ajusta background
    function moveLens(evt){
      if(!active) return;
      evt.preventDefault();
      const rect = img.getBoundingClientRect();
      let clientX, clientY;
      if(evt.touches && evt.touches[0]){clientX = evt.touches[0].clientX; clientY = evt.touches[0].clientY;} else {clientX = evt.clientX; clientY = evt.clientY}
      // posi√ß√£o dentro da imagem
      const x = clientX - rect.left;
      const y = clientY - rect.top;
      // evita sair fora
      const posX = Math.max(0, Math.min(rect.width, x));
      const posY = Math.max(0, Math.min(rect.height, y));
      const percentX = posX / rect.width * 100;
      const percentY = posY / rect.height * 100;

      // posiciona lente
      lens.style.left = `${rect.left + posX}px`;
      lens.style.top = `${rect.top + posY}px`;

      // calcula background position para a lente (usando escala natural/display)
      const scaleX = parseFloat(lens.dataset.scaleX || 1);
      const scaleY = parseFloat(lens.dataset.scaleY || 1);
      const bgX = -(posX * scaleX - lensSize/2 * zoom);
      const bgY = -(posY * scaleY - lensSize/2 * zoom);
      lens.style.backgroundSize = `${img.naturalWidth * zoom}px ${img.naturalHeight * zoom}px`;
      lens.style.backgroundPosition = `${bgX}px ${bgY}px`;

      // atualiza janela lateral
      if(showSide){
        // coloca o centro da janela lateral na mesma √°rea
        const rx = Math.max(0, Math.min(img.naturalWidth, posX * scaleX));
        const ry = Math.max(0, Math.min(img.naturalHeight, posY * scaleY));
        resultImg.style.objectPosition = `${(rx/img.naturalWidth)*100}% ${(ry/img.naturalHeight)*100}%`;
        // escalamos a imagem no result para mostrar o detalhe ampliado
        resultImg.style.width = `${img.naturalWidth * zoom / (img.naturalWidth / result.clientWidth)}px`;
      }
    }

    // Eventos
    img.addEventListener('load', prepare);
    window.addEventListener('resize', prepare);

    // Movimenta√ß√£o do rato
    img.addEventListener('mousemove', moveLens);
    img.addEventListener('touchmove', moveLens, {passive:false});

    // Mostrar lente tamb√©m quando o cursor entra (√∫til para desktop)
    img.addEventListener('mouseenter', (e)=>{ if(active) lens.style.display='block' });
    img.addEventListener('mouseleave', (e)=>{ if(active) lens.style.display='none' });

    // Inicializar (caso a imagem j√° esteja em cache)
    if(img.complete) prepare();

    // Acessibilidade: atalho de teclado (L) para ativar/desativar
    document.addEventListener('keydown', (e)=>{
      if(e.key.toLowerCase() === 'l'){
        toggleBtn.click();
      }
      if(e.key.toLowerCase() === 'j'){
        toggleSide.click();
      }
    });

    // Permite trocar a imagem dinamicamente (exemplo)
    // Exemplo: image.src = 'outra-imagem.jpg'; prepare();

  </script>
</body>
</html>
