<!doctype html>
<html lang="pt-PT">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RIP Bandicoots</title>
  <style>
    :root{--lens-size:140px;--zoom:2.5}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,\"Helvetica Neue\",Arial;display:flex;align-items:center;justify-content:center;min-height:100vh;margin:0;background:#f5f6f8;color:#111}
    .card{background:#fff;border-radius:12px;padding:18px;box-shadow:0 6px 18px rgba(16,24,40,0.06);max-width:900px;width:95%}
    h1{margin:0 0 12px;font-size:18px}
    .controls{display:flex;gap:8px;align-items:center;margin-bottom:12px}
    .btn{background:#0b5fff;color:#fff;border:0;padding:8px 12px;border-radius:8px;cursor:pointer;display:inline-flex;gap:8px;align-items:center}
    .btn.secondary{background:#e6eefc;color:#03396b}
    .img-wrap{position:relative;max-width:700px}
    img.zoomable{max-width:100%;display:block;border-radius:8px}

    .lens{
      position:absolute;
      border-radius:50%;
      width:var(--lens-size);
      height:var(--lens-size);
      box-shadow:0 6px 18px rgba(2,6,23,0.15), inset 0 0 12px rgba(255,255,255,0.3);
      pointer-events:none;
      display:none;
      background-repeat:no-repeat;
      border:2px solid rgba(255,255,255,0.6);
      transform:translate(-50%, -50%);
    }

    .hint{font-size:13px;color:#556;}

    .result{
      position:absolute;right:-320px;top:0;width:300px;height:300px;border-radius:8px;overflow:hidden;border:1px solid #e6e9ef;background:#fff;display:none;box-shadow:0 6px 18px rgba(2,6,23,0.06)
    }
    .result img{width:100%;height:100%;object-fit:cover;transition: object-position 0.05s linear;}

    @media (max-width:900px){
      .result{display:none !important;right:0;position:relative;margin-top:12px}
      .img-row{display:block}
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>RIP Bandicoots</h1>
    <div class="controls">
      <button id="toggleLens" class="btn" aria-pressed="false" title="Ativar / Desativar lupa">üîç Ativar lupa</button>
      <button id="toggleSide" class="btn secondary" title="Mostrar / ocultar janela lateral de zoom">‚ñ¢ Janela de zoom</button>
      <div class="hint">Move o cursor sobre a imagem (ou toca) depois de ativar a lupa.</div>
    </div>

    <div class="img-row" style="display:flex;gap:18px;align-items:flex-start;position:relative">
      <div class="img-wrap">
        <img id="image" class="zoomable" src="Bandicoots.png" alt="RIP Bandicoots">
        <div id="lens" class="lens" role="img" aria-hidden="true"></div>
      </div>

      <div id="result" class="result" aria-hidden="true">
        <img id="resultImg" alt="Zoom da imagem">
      </div>
    </div>
  </div>

  <script>
    const img = document.getElementById('image');
    const lens = document.getElementById('lens');
    const toggleBtn = document.getElementById('toggleLens');
    const toggleSide = document.getElementById('toggleSide');
    const result = document.getElementById('result');
    const resultImg = document.getElementById('resultImg');

    let active = false;
    let showSide = false;

    const zoom = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--zoom')) || 2.5;
    const lensSize = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--lens-size')) || 140;

    function prepare(){
      const naturalW = img.naturalWidth;
      const naturalH = img.naturalHeight;
      lens.style.backgroundImage = `url('${img.src}')`;
      const rect = img.getBoundingClientRect();
      const scaleX = naturalW / rect.width;
      const scaleY = naturalH / rect.height;
      lens.dataset.scaleX = scaleX;
      lens.dataset.scaleY = scaleY;
      resultImg.src = img.src;
      result.style.display = showSide ? 'block' : 'none';
    }

    toggleBtn.addEventListener('click', ()=>{
      active = !active;
      toggleBtn.textContent = active ? 'üîç Lupa ativa' : 'üîç Ativar lupa';
      toggleBtn.setAttribute('aria-pressed', String(active));
      lens.style.display = active ? 'block' : 'none';
      result.style.display = active && showSide ? 'block' : 'none';
    });

    toggleSide.addEventListener('click', ()=>{
      showSide = !showSide;
      toggleSide.textContent = showSide ? '‚ñ¢ Janela vis√≠vel' : '‚ñ¢ Janela de zoom';
      result.style.display = showSide && active ? 'block' : 'none';
    });

    function moveLens(evt){
      if(!active) return;
      evt.preventDefault();
      const rect = img.getBoundingClientRect();
      let clientX, clientY;
      if(evt.touches && evt.touches[0]){clientX = evt.touches[0].clientX; clientY = evt.touches[0].clientY;} else {clientX = evt.clientX; clientY = evt.clientY}
      let x = clientX - rect.left;
      let y = clientY - rect.top;
      x = Math.max(0, Math.min(rect.width, x));
      y = Math.max(0, Math.min(rect.height, y));

      lens.style.left = `${x}px`;
      lens.style.top = `${y}px`;

      const scaleX = parseFloat(lens.dataset.scaleX || 1);
      const scaleY = parseFloat(lens.dataset.scaleY || 1);
      const bgX = -(x * scaleX * zoom - lensSize / 2);
      const bgY = -(y * scaleY * zoom - lensSize / 2);
      lens.style.backgroundSize = `${img.naturalWidth * zoom}px ${img.naturalHeight * zoom}px`;
      lens.style.backgroundPosition = `${bgX}px ${bgY}px`;

      if(showSide){
        const rx = x * scaleX;
        const ry = y * scaleY;
        resultImg.style.objectPosition = `${(rx/img.naturalWidth)*100}% ${(ry/img.naturalHeight)*100}%`;
      }
    }

    img.addEventListener('load', prepare);
    window.addEventListener('resize', prepare);
    img.addEventListener('mousemove', moveLens);
    img.addEventListener('touchmove', moveLens, {passive:false});
    img.addEventListener('mouseenter', ()=>{ if(active) lens.style.display='block'; });
    img.addEventListener('mouseleave', ()=>{ if(active) lens.style.display='none'; });
    if(img.complete) prepare();

    document.addEventListener('keydown', (e)=>{
      if(e.key.toLowerCase() === 'l'){ toggleBtn.click(); }
      if(e.key.toLowerCase() === 'j'){ toggleSide.click(); }
    });
  </script>
</body>
</html>
